apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - backend-config.yaml
  - backend-config-crd.yaml
  - cloudsql-instance.yaml
  - cloudsql-serviceaccount.yaml
  - deployment.yaml
  - frontend-config.yaml
  - ingress.yaml
  - networkpolicy.yaml
  - service.yaml
  - serviceaccount.yaml
  - ssl-certificate.yaml
  - static-ip.yaml

labels:
  - pairs:
      app.kubernetes.io/managed-by: flux
      app.kubernetes.io/created-by: hobby-cluster

commonAnnotations:
  policy.kubernetes.io/validate: "true"
  fluxcd.io/automated: "true"


configMapGenerator:
  - name: config
    behavior: create
    literals:
      - NODE_ENV=production
      - NEXTAUTH_URL=https://portfolio.example.com
      - CLOUD_SQL_CONNECTION_NAME=PROJECT_ID:us-central1:portfolio-db-base

secretGenerator:
  - name: secrets
    behavior: create
    literals:
      - NEXTAUTH_SECRET=change-me-in-overlay
  - name: db-secret
    behavior: create
    literals:
      - DATABASE_URL=postgresql://portfolio-db-user:change-me-in-overlay@localhost:5432/portfolio-db-database
  - name: db-password
    behavior: create
    literals:
      - password=change-me-in-overlay
